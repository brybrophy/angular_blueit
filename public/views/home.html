<div ng-controller="TopicsCtrl as topics">
  <aside class="col-sm-4 col-md-2">
    <form ng-if="!authorize.isLoggedIn()" ng-submit="authorize.login()" class="collapse-form hidden-md hidden-lg row" role="search">
      <div class="form-group">
        <a ng-click="authorize.show = true" class="pull-right" href="#/">
          Not a member? Register here.
        </a>

        <label for="username"></label>
        <input ng-model="authorize.username" name="username" type="text" class="form-control" placeholder="username">

        <label for="password"></label>
        <input ng-model="authorize.password" name="password" type="password" class="form-control" placeholder="password">

      </div>
      <button type="text" class="btn btn-default pull-right">
        Login
      </button>
    </form>
    <section class="row">

      <div class="panel panel-default">
        <div class="panel-heading">Topics</div>
        <div class="panel-body">

          <form novalidate ng-submit="topics.addTopic()" name="topicsForm">
            <div class="form-group">
              <label for="search-topics"></label>
              <div class="input-group">
                <input ng-model="searchTopics" type="text" class="form-control" name="search-topics" placeholder="Search Topics">
                <span class="input-group-btn">
                  <button class="btn btn-secondary glyphicon glyphicon-search" type="submit" name="action"></button>
                </span>
              </div>
            </div>

            <div class="form-group">
              <label for="topicName"></label>
              <div class="input-group">
                <input ng-model="topics.topicsForm.topicName" ng-minlength="3" ng-maxlength="20" type="text" class="form-control" name="topicName" placeholder="Add Topic" required>
                <span class="input-group-btn">
                  <button class="btn btn-secondary glyphicon glyphicon-plus" type="submit" name="action"></button>
                </span>
              </div>
              <div class="has-error" ng-show="topicsForm.topicName.$dirty && topicsForm.topicName.$invalid">
                <small class="has-error"  ng-show="topicsForm.topicName.$error.required && !topicsForm.topicName.$pristine">
                  Topic Name is required.
                </small>
                <small class="error"
                ng-show="topicsForm.topicName.$error.minlength">
                  Topic names cannot be fewer than 3 characters.
                </small>
                <small class="error"
                ng-show="topicsForm.topicName.$error.maxlength">
                  Topic names cannot be longer than 20 characters.
                </small>
              </div>
            </div>
          </form>
        </div>

        <div class="list-group">
          <button ng-click="topics.filterBy = ''" type="button" class="list-group-item">
           All
         </button>
          <button ng-click="topics.filterBy = topic.id" ng-repeat="topic in topics.topics | orderBy: 'name' | filter : searchTopics" type="button" class="list-group-item" ng-cloak>
            {{ topic.name }}
          </button>
        </div>
      </div>
    </section>
  </aside>
  <section ng-controller="RegisterCtrl as register" class="col-sm-8 col-md-6 col-md-offset-1 main">
    <form ng-show="authorize.show" ng-submit="register.newUser()" class="row register-form" name="registerForm">
      <label for="userRegister">Username</label>
      <input ng-model="register.username" class="form-control" type="text" name="userRegister" placeholder="">

      <label for="userRegister">Email</label>
      <input ng-model="register.email" class="form-control" type="email" name="emailRegister" placeholder="example@blueit.com">

      <label for="userRegister">Password</label>
      <input ng-model="register.password" class="form-control" type="password" name="passwordRegister" placeholder="must be 8 or more characters">

      <button ng-click="view.showRegister=false" class="pull-right btn btn-default add-post-btn" type="submit" name="action">
        Register
      </button>

      <span ng-click="authorize.show = false" class="pull-right btn btn-default add-post-btn" type="text">
        Cancel
      </span>
    </form>
    <nav class="row">
      <div class="col-lg-10">
        <h1>Posts</h1>
      </div>
      <ul class="nav nav-tabs pull-left">
        <li ng-click="posts.sortBy = '-rating'" role="presentation" data-toggle="tab" class="active">
          <a href="#/">Highest</a>
        </li>
        <li ng-click="posts.sortBy = 'rating'" role="presentation" data-toggle="tab">
          <a href="#/">Lowest</a>
        </li>
        <li ng-click="posts.sortBy = '-created_at'" role="presentation" data-toggle="tab">
          <a href="#/">Newest</a>
        </li>
        <li ng-click="posts.sortBy = 'created_at'" role="presentation" data-toggle="tab">
          <a href="#/">Oldest</a>
        </li>
      </ul>
      <button ng-click="showAddPost=true" type="text" class="btn btn-default col-lg-2 add-post pull-right">Add New Post</button>
    </nav>

    <form ng-show="showAddPost"  ng-submit="posts.addPost()" class="row add-post-form" novalidate name="postsForm" role="search">
      <label for="postTopic">Topic</label>
      <select name="postTopic" class="form-control" ng-model="posts.topic">
        <option selected disabled>Choose Topic</option>
        <option value="{{ topic.id }}" ng-repeat="topic in topics.topics | orderBy : 'name'">
          {{ topic.name }}
        </option>
      </select>

      <label for="postTitle">Title</label>
      <input ng-model="posts.postsForm.postTitle" name="postTitle" type="text" class="form-control" placeholder="Title">

      <label for="postTitle">Description</label>
      <input ng-model="posts.postsForm.postDescription" name="postDescription" type="text" class="form-control" placeholder="Description">

      <label for="postImg">Image URL</label>
      <input ng-model="posts.postsForm.imgUrl" type="text" class="form-control" name="postImg" placeholder="http://www.example.com/image" required>

      <button ng-click="showAddPost=false" class="pull-right btn btn-default add-post-btn" type="submit" name="action">
        Submit Post
      </button>

      <span ng-click="showAddPost=false" class="pull-right btn btn-default add-post-btn" type="text">
        Cancel
      </span>
    </form>

    <article ng-repeat="post in posts.posts | orderBy : posts.sortBy | filter : { topic_id: topics.filterBy } " class="row">
        <div class="col-sm-6 post-content">
          <h4 class="row post-title text-center">
            "{{ post.title }}"
          </h4>
          <p class="row post-description text-center">{{ post.description }}</p>
          <small class="row pull-left">
            <span class="post-time" am-time-ago="{{ post.created_at }}"></span>
          </small>
        </div>
        <a ng-href="{{ post.image_url }}"><div class="col-sm-5" ng-style=" {'background-image': 'URL({{ post.image_url }})', 'background-repeat': 'no-repeat', 'border': '1px solid #9098A1', 'background-size': 'cover', 'height': '238px', 'top': '-1px'  }"></div></a>
        <section class="col-sm-1 votes">
            <i ng-click="posts.upVote(post)" class="glyphicon glyphicon-thumbs-up"></i>
            <p>{{ post.rating }}</p>
            <i ng-click="posts.downVote(post)" class="glyphicon glyphicon-thumbs-down"></i>
        </section>
    </article>
  </section>
</div>
